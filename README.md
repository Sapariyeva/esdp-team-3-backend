# API для музыкального приложения (типа Last.FM). 

Эти эндпойнты позволяют создавать и получать исполнителей, альбомы и треки


## POST

**/users** - регистрация (создание) нового пользователя

**/users/sessions** - логин пользователя

- Во время обработки этого роута создается token и записывается в сущность "Пользователь". Токен создается с помощью nanoid. Этот токен возвращается как ответ (response) данного роута, если пользователь ввел правильные данные. Например:
{"token": "5enDI2paOqusPavVWOnwB"}

**/users/signOut** - разлогин пользователя

- на сервер в headers должен отправляться токен. Токен может быть записан как с приставкой Bearer, так и без нее. Сервер обрабатывает оба варианта. То же самое касается всех ситуаций, где используется токен. По токену производится поиск пользователя. Если пользователь найден. токен перезаписывается на пустую строку. А в ответ приходит
```
{
    success: true,
    message: 'You logged out'
}
```

**/track_history** 

- Принимает токен аутентификации через заголовки запроса, например:
Authorization: 5enDI2paOqusPavVWOnwB,
либо Authorization: Bearer 5enDI2paOqusPavVWOnwB
Используя этот параметр находит пользователя с таким token. Если пользователь не найден, token считается неверным и возвращается ответ с ошибкой 401 Unauthorized.

- Также принимает один параметр через тело запроса (JSON): track - это ID прослушанной композиции. На сервере в базе данных запись создается запись, связанная с этим track ID а также с тем пользователем, который был найден с помощью токена, а также с текущей датой.

**/artists** должен содержать поля в формате form-data:
 - name (text)
 - photo (file)
 - info (text)

При таком запросе создается новый исполнитель в базе данных;
Есть проверка на уникальность имени. Если такое имя исполнителя уже есть, новый не добавится и вернется ошибка.
В ответе возвращается JSON-объект, например:
```
{
  "id": 1,
  "name" "Linkin Park",
  "photo": "4b62f729-bc05-4aee-bb1e-cdef05d7e247.jpg",
  "info": "some info about band..."
}
```

**/albums** должен содержать поля в формате form-data:
 - title (text)
 - artistId (text)
 - releaseYear (text)
 - coverImage (file)

При таком запросе создается новый альбом в базе данных; 
artistId указывает на исполнителя, который выпустил альбом.
Если исполнитель не будет найден, альбом не добавится.
Также есть проверка на уникальность названия. Если такое название альбома уже есть, новый не добавится.
В обоих случаях вернется ошибка.
В ответе возвращается JSON-объект, например:
```
{
  "id": 1,
  "title" "Minutes To Midnight",
  "artistId": 1,
  "releaseYear": 2007,
  "coverImage": "ca0e4c42-84bb-4be1-b876-77b7440024d5.jpg"
}
```

**/tracks** должен содержать поля в формате form-data:
 - title (text)
 - albumId (text)
 - trackNumber (text)
 - duration (text)
 - watchOnYoutube (text)
 - mp3 (file)

При таком запросе создается новый трек в базе данных;
albumId указывает на альбом, в котором был выпущен трек.
Если альбом не будет найден, трек не добавится и вернется ошибка.
Многие треки на сегодняшний день имеют одинаковые названи, так что проверки уникальности на названиях треков нет.
trackNumber указывает порядковый номер трека в рамках альбома, в рамках этого же альбома он должен быть уникальным
mp3 файл прикреплять необязательно, однако если его прикрепить, то duration будет подтянут из свойств файла
Если не будут отправлены ни файл, ни само поле duration вернется ошибка
watchOnYoutube необязательное поле, в котором можно хранить id видеоклипа с Youtube данного трека
В ответе возвращается JSON-объект, например:
```
{
  "id": 38,
  "title" "What I’ve Done",
  "albumId": 1,
  "duration": 205,
  "watchOnYoutube": "8sgycukafqQ",
  "mp3": "325f4c41-8b16-49c5-b2c0-9044e4030e32.mp3"
}
```


**/***entities***/:id/publish** - позволяет опубликовывать исполнителей, альбомы или треки по ID

**/***entities***/:id/unpublish** - позволяет позволяет отменять публикацию исполнителей, альбомов или треков по ID

вместо ***entities*** нужно подставить одно из следующих значений:
- ***artists***
- ***albums***
- ***tracks***


## DELETE

**/***entities***/:id** - позволяет удалить исполнителя, альбом или трек по ID

вместо ***entities*** нужно подставить одно из следующих значений:
- ***artists***
- ***albums***
- ***tracks***


## GET

**/artists** возвращает список опубликованных исполнителей
 - Если в headers будет передан токен аутентификации, то в зависимости от роли могут быть возвращены и неопубликованные исполнители

**/albums** возвращает все опубликованные альбомы
 - Также можно передать ID "artist" как query-параметр и получить список альбомов конкретного исполнителя. (/albums?artist=....)
 - Если в headers будет передан токен аутентификации, то в зависимости от роли могут быть возвращены и неопубликованные альбомы

**/albums/:id** возвращает информацию о конкретном альбоме, включая информацию о его исполнителе.

**/tracks** возвращает все опубликованные треки
 - Также можно передать ID "album" как query-параметр и получить список треков в конкретном альбоме. (/tracks?album=....)
 - Также можно передать ID "artist" как query-параметр и получить список треков конкретного исполнителя. (/tracks?artist=....)
 - Если в headers будет передан токен аутентификации, то в зависимости от роли могут быть возвращены и неопубликованные треки


## Запуск фикстур

Прописать в корневой директории проекта
```
npm run seed
```
